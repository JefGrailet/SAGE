# INSIGHT - A Python library to model and study networks

*By Jean-Fran√ßois Grailet (last updated: November 29, 2021)*

## About

**N.B.:** if you reached this part of the repository via a direct link, please note that this 
sub-folder doesn't provide the data collected by `SAGE` nor its source code. You will rather find 
them respectively in the **Dataset/** and **src/** sub-folders at the root of this repository.

`INSIGHT` (which stands for _**I**nvestigate **N**etworks from **S**ubnet **I**nference to 
**G**rap**H** **T**ransformations_) is a small Python library devised for parsing and transforming 
the data collected by `SAGE` in order to model and analyze the measured networks. It relies on the 
[NetworkX Python library](https://networkx.org/) in order to build graphs (directed or bipartite), 
extract their metrics and render them visually. In addition, `INSIGHT` comes with a module for 
plotting the metrics it could compute thanks to NetworkX.

Running `INSIGHT` on a network snapshot collected by `SAGE` (i.e., the entire set of files 
produced by `SAGE` in a single run while probing a single target network) will help users to 
visualize it and study the main characteristics of the corresponding network.

## Content

All the source files (in Python) of `INSIGHT` are located in this sub-folder. The **Results/** 
sub-folder provides pre-computed figures and plots for each snapshot found in the dataset. The 
file hierarchy of this sub-folder matches the target network and the date of the snapshot (e.g., 
for figures computed with the snapshot of AS1241 collected on 12/09/2020, go to 
`Results/AS1241/2020/09/12/`).

## Usage

You can run `INSIGHT` on a single snapshot with the following command:

```sh
python INSIGHT.py [Mode] [Snapshot prefix] [Output files prefix]
```

where:
* **Mode** is the type of graph you want to output and/or analyze. Currently available modes are 
  described below.
* **Snapshot prefix** is the complete path (absolute or relative) to the files of a network 
  snapshot where all output files only differ by extension. E.g., if you want to use a snapshot 
  from this repository, e.g. AS1241 on 12/09/2020, the snapshot prefix will be 
  `/path/to/repository/root/Dataset/AS1241/2020/09/12/AS1241_12-09`.
* **Output files prefix** is the prefix for the output files generated by `INSIGHT`. The amount of 
  files and their respective content depend on the mode.

Alternatively, you can also run the `process.sh` Shell script to run `INSIGHT` on multiple 
snapshots using the most interesting modes, as long as you modify the `datasetPath` variable at 
the start of the script to match your file system. Then, you can use this kind of command:

```sh
./process.sh [AS number]
```

where **AS number** is the name of an AS (**A**utonomous **S**ystem) present in the dataset (e.g., 
AS13789, AS224, etc.). This will run `INSIGHT` on all snapshots for this AS (except snapshots that 
have been already processed) and move the output files to a `Results/AS number/yyyy/mm/dd/` 
sub-folder created by the script. Note that this script also comes with two options you can check 
by typing `./process.sh` without arguments in your terminal.

## Modes

`INSIGHT` currently provides four different modes.

* `Raw`: creates a visual render of a neighborhood-based directed acyclic graph. The purpose of 
  this mode is to visualize the graphs created by `SAGE` without any intermediate processing.

* `Bip`: translates a neighborhood-based directed acyclic graph as built by `SAGE` into a simple 
  neighborhood - subnet bipartite graph. After building the graph, `INSIGHT` will generate 4 PDF 
  figures: one to quantify cycles (`Prefix_Bip_cycles.pdf`), one to visualize the degree of 
  vertices (`Prefix_Bip_degree_CDFs.pdf`), one to review the clustering of top vertices a.k.a. 
  neighborhoods (`Prefix_Bip_top_local_density.pdf`) and finally a visual render of the whole 
  graph (`Prefix_Bip_graph.pdf`). The console output will also provide several useful details, 
  such as the degree distributions and the vertices corresponding to the highest degrees or the 
  mappings between subnets and bottom vertices. It is advised to flush this output into a text 
  file (text files are provided within the `Results/` sub-repository).

* `BipProjTop`: translates a neighborhood-based directed acyclic graph as built by `SAGE` into a 
  simple neighborhood - subnet bipartite graph and projects it on neighborhoods (top vertices). 
  Due to `SAGE` being able to map a same subnet to multiple edges while building a graph, the 
  resulting bipartite graph can reveal new adjacencies that were not visible during the 
  measurements. These additional adjacencies are translated as well in the projection, which is 
  provided as a simple text file (`Prefix_BipProjTop.txt`) in which each line gives a neighborhood 
  and its list of adjacent neighborhoods.

* `BipProjBot`: translates a neighborhood-based directed acyclic graph as built by `SAGE` into a 
  simple neighborhood - subnet bipartite graph and projects it on subnets (bottom vertices). The 
  result is provided in the same format as for `BipProjTop`. Be wary that a projection on subnets 
  can get quite big and is usually much larger than the projection on neighborhoods of the same 
  graph.

* `Trip`: translates a neighborhood-based directed acyclic graph as built by `SAGE`, completed by 
  the alias resolution data captured during its final algorithmic step, into a (hypothetical) 
  Layer-2 - router - subnet tripartite graph. The first two parties (hypothetical Layer-2 - 
  router) account for the inner components of neighborhoods. The subnets (third party) 
  are used exactly in the same manner as in simple bipartite graphs, except they connect 
  (inferred) routers rather than neighborhoods. This formalism was designed to study the router 
  degree and assess the potential presence of Layer-2 equipment within large networks. It 
  currently only outputs the graph itself (as two files, suffixed in `.trip-mappings` for the 
  vertices and `.trip-graph` for the edges), a figure plotting the distributions of different 
  definitions of the router degree (suffixed in `_router_degrees.pdf`) and a figure illustrating 
  the clustering coefficients of (inferred) routers in function of their degree in the tripartite 
  graph. It is worth noting that tripartite graphs built by `INSIGHT` currently do not include 
  edges connecting (hypothetical) Layer-2 devices with subnets.

**Remark about graph visuals:** while `INSIGHT` can usually process a data snapshot quickly, the 
rendering of a graph (directed or bipartite) can take some time, especially with large networks. 
Starting from Spring 2021, `INSIGHT` allows one to set a limit (optional command line parameter) 
for the total number of vertices in a graph that can be rendered. E.g., if this limit is set to 
10,000, then a graph featuring around 15,000 vertices will not be rendered.

## Changes history

* **October 23, 2020:** first public version of `INSIGHT`. Handles directed graphs (raw 
  translations of graphs built by `SAGE`) and simple bipartite graphs (neighborhood - subnet).

* **March 31, 2021:** first major update of `INSIGHT`. Several minor issues with the simple 
  bipartite graphs have been fixed; as a consequence, all text files and figures provided for such 
  graphs have been re-computed for all the available snapshots. Two new modes, `BipProjTop` and 
  `BipProjBot`, allows one to compute the projection on neighborhoods (`BipProjTop`) or subnets 
  (`BipProjBot`) of a neighborhood - subnet bipartite graph, said projections being given as text 
  files listing vertices and their respective adjacencies. Projections on neighborhoods have been 
  computed for all the available snapshots too.

* **June 30, 2021:** second major update `INSIGHT`. In addition to many new figures/results 
  generated for snapshots collected during Spring 2021 (until late May), this update brings the 
  `DoubleBip` mode, which allows one to turn a `SAGE` snapshot into a double bipartite graph where 
  the three parties are respectively (hypothetical) Layer-2 devices, routers and subnets. The 
  first two parties, i.e. the virtual Layer-2 equipment with routers, replace the neighborhoods 
  modeled in the simple bipartite formalism. This additional formalism is meant to study the 
  router degree (i.e., how many routers a given router is adjacent too), and in particular, 
  assess the potential presence of Layer-2 equipment. This mode involves using the (final) alias 
  resolution data captured by `SAGE`. It is still work in progress, as the alias resolution data 
  should ideally be post-processed to infer routers more accurately.

* **November 28, 2021:** terminology change: double bipartite graphs are now called tripartite 
  graphs. This change has been applied to both the source files of `INSIGHT` and the names of the 
  files produced by the `Trip` mode (formerly `DoubleBip`) which are located within the `Results/` 
  sub-folder.

## Contact

**E-mail address:** Jean-Francois.Grailet@uliege.be

**Personal website:** http://www.run.montefiore.ulg.ac.be/~grailet/
